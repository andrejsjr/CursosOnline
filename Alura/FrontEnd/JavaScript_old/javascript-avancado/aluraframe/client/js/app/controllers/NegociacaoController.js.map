{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Negociacao","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_ordemAtual","_erroBusca","_erroImportacao","_mensagem","_service","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","setInterval","importaNegociacoes","textoParaData","value","parseInt","parseFloat","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","erro","importa","apaga","focus","coluna","inverteOrdem","ordena","a","b","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\r\nimport {Negociacao} from '../models/Negociacao';\r\nimport {Mensagem} from '../models/Mensagem';\r\nimport {NegociacoesView} from '../views/NegociacoesView';\r\nimport {MensagemView} from '../views/MensagemView';\r\nimport {NegociacaoService} from '../services/NegociacaoService';\r\nimport {DateHelper} from '../helpers/DateHelper';\r\nimport {Bind} from '../helpers/Bind';\r\n\r\nclass NegociacaoController {\r\n    constructor() {\r\n        let $ = document.querySelector.bind(document);\r\n\r\n        this._inputData = $('#data');\r\n        this._inputQuantidade = $('#quantidade');\r\n        this._inputValor = $('#valor');\r\n        \r\n        this._listaNegociacoes = new Bind(new ListaNegociacoes(),\r\n            new NegociacoesView($('#NegociacoesView')), 'adiciona', 'apaga', 'ordena', 'inverteOrdem');\r\n\r\n        this._ordemAtual = '';\r\n        this._erroBusca = false;\r\n        this._erroImportacao = false;        \r\n        \r\n        this._mensagem = new Bind(new Mensagem(),\r\n            new MensagemView($('#mensagemView')), 'texto');\r\n\r\n        this._service = new NegociacaoService();\r\n\r\n        this._init();\r\n    }\r\n    \r\n    _init() {\r\n        this._service.lista()\r\n            .then(negociacoes => negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao)))\r\n            .catch(erro => {\r\n                this._erroBusca = true;\r\n                this._mensagem.texto = 'Não foi possível buscar negociações.';\r\n            });\r\n        \r\n        setInterval(() => {\r\n            if (!this._erroImportacao && !this._erroBusca)\r\n                this.importaNegociacoes();\r\n        }, 3000);\r\n    }\r\n        \r\n    _criaNegociacao() {\r\n        return new Negociacao(\r\n            DateHelper.textoParaData(this._inputData.value),\r\n                parseInt(this._inputQuantidade.value), parseFloat(this._inputValor.value) \r\n        );\r\n    }\r\n\r\n    adiciona(event) {\r\n        event.preventDefault();\r\n\r\n        var negociacao = this._criaNegociacao();\r\n\r\n        this._service.cadastra(negociacao)\r\n            .then(mensagem => {\r\n                this._listaNegociacoes.adiciona(negociacao);\r\n                this._mensagem.texto = mensagem;\r\n                this._limpaFormulario();\r\n            })\r\n            .catch((erro) => this._mensagem.texto = erro);        \r\n    }\r\n\r\n    importaNegociacoes() {\r\n        this._service.importa(this._listaNegociacoes.negociacoes)\r\n            .then(negociacoes => negociacoes.forEach(negociacao => {\r\n                this._listaNegociacoes.adiciona(negociacao);\r\n                this._mensagem.texto = 'Negociações importadas com sucesso';\r\n            }))\r\n            .catch(erro => {\r\n                this._erroImportacao = true;\r\n                this._mensagem.texto = 'Não foi possível importar negociações.';\r\n            });\r\n    }\r\n\r\n    apaga() {\r\n        this._service.apaga()\r\n            .then(mensagem => {\r\n                this._listaNegociacoes.apaga();\r\n                this._mensagem.texto = mensagem;\r\n            })\r\n            .catch(erro => this._mensagem.texto = erro);\r\n    }\r\n\r\n    _limpaFormulario() {\r\n        this._inputData.value = '';\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0.0;\r\n\r\n        this._inputData.focus();\r\n    }\r\n    \r\n    ordena(coluna) {\r\n        if(this._ordemAtual == coluna) {\r\n            this._listaNegociacoes.inverteOrdem();\r\n        } else {\r\n            this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);    \r\n        }\r\n        this._ordemAtual = coluna;\r\n    }\r\n}\r\n\r\nvar negociacaoController = new NegociacaoController();\r\n\r\nexport function currentInstance() {\r\n    return negociacaoController;\r\n}"]}