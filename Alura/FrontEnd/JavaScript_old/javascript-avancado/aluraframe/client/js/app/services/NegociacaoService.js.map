{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","Negociacao","NegociacaoDao","NegociacaoService","_service","Promise","all","obterNegociacoesDaSemana","obterNegociacoesDaSemanaAnterior","obterNegociacoesDaSemanaRetrasada","then","listaTodasAsNegociacoes","reduce","todasAsNegociacoes","negociacoes","concat","catch","console","log","erro","Error","get","map","Date","objeto","data","quantidade","valor","negociacao","getConnection","connection","dao","adiciona","mensagem","apagaTodos","listaTodos","listaAtual","obterNegociacoes","filter","some","negociacaoExistente","isEquals"],"mappings":";;;;;;;;;;;;;;;AAAQA,uB,gBAAAA,W;;AACAC,6B,sBAAAA,iB;;AACAC,sB,qBAAAA,U;;AACAC,yB,qBAAAA,a;;;;;;;;;;;;;;;;;;;;;yCAEKC,iB;AACT,6CAAc;AAAA;;AACV,yBAAKC,QAAL,GAAgB,IAAIL,WAAJ,EAAhB;AACH;;;;uDAEkB;AACf,+BAAOM,QAAQC,GAAR,CAAY,CACf,KAAKC,wBAAL,EADe,EAEf,KAAKC,gCAAL,EAFe,EAGf,KAAKC,iCAAL,EAHe,CAAZ,EAKNC,IALM,CAKD,mCAA2B;AAC7B,mCAAOC,wBACFC,MADE,CACK,UAACC,kBAAD,EAAqBC,WAArB;AAAA,uCAAqCD,mBAAmBE,MAAnB,CAA0BD,WAA1B,CAArC;AAAA,6BADL,EACkF,EADlF,CAAP;AAEH,yBARM,EASNE,KATM,CASA,gBAAQ;AACXC,oCAAQC,GAAR,CAAYC,IAAZ;AACA,kCAAM,IAAIC,KAAJ,CAAUD,IAAV,CAAN;AACH,yBAZM,CAAP;AAaH;;;+DAE0B;AACvB,+BAAO,KAAKf,QAAL,CAAciB,GAAd,CAAkB,oBAAlB,EACFX,IADE,CACG,uBAAe;AACjB,mCAAOI,YAAYQ,GAAZ,CAAgB;AAAA,uCAAU,IAAIrB,UAAJ,CAAe,IAAIsB,IAAJ,CAASC,OAAOC,IAAhB,CAAf,EAC7BD,OAAOE,UADsB,EACVF,OAAOG,KADG,CAAV;AAAA,6BAAhB,CAAP;AAEH,yBAJE,EAKFX,KALE,CAKI,gBAAQ;AACXC,oCAAQC,GAAR,mEAAgEC,IAAhE;AACA,kCAAM,IAAIC,KAAJ,CAAUD,IAAV,CAAN;AACA;AACH,yBATE,CAAP;AAUH;;;uEAEkC;AAC/B,+BAAO,KAAKf,QAAL,CAAciB,GAAd,CAAkB,sBAAlB,EACFX,IADE,CACG,uBAAe;AACjB,mCAAOI,YAAYQ,GAAZ,CAAgB;AAAA,uCAAU,IAAIrB,UAAJ,CAAe,IAAIsB,IAAJ,CAASC,OAAOC,IAAhB,CAAf,EAC7BD,OAAOE,UADsB,EACVF,OAAOG,KADG,CAAV;AAAA,6BAAhB,CAAP;AAEH,yBAJE,EAKFX,KALE,CAKI,gBAAQ;AACXC,oCAAQC,GAAR,4EAAyEC,IAAzE;AACA,kCAAM,IAAIC,KAAJ,CAAUD,IAAV,CAAN;AACA;AACH,yBATE,CAAP;AAUH;;;wEAEmC;AAChC,+BAAO,KAAKf,QAAL,CAAciB,GAAd,CAAkB,uBAAlB,EACFX,IADE,CACG,uBAAe;AACjB,mCAAOI,YAAYQ,GAAZ,CAAgB;AAAA,uCAAU,IAAIrB,UAAJ,CAAe,IAAIsB,IAAJ,CAASC,OAAOC,IAAhB,CAAf,EAC7BD,OAAOE,UADsB,EACVF,OAAOG,KADG,CAAV;AAAA,6BAAhB,CAAP;AAEH,yBAJE,EAKFX,KALE,CAKI,gBAAQ;AACXC,oCAAQC,GAAR,6EAA0EC,IAA1E;AACA,kCAAM,IAAIC,KAAJ,CAAUD,IAAV,CAAN;AACA;AACH,yBATE,CAAP;AAUH;;;6CAEQS,U,EAAY;AACjB,+BAAO5B,kBAAkB6B,aAAlB,GACFnB,IADE,CACG;AAAA,mCAAc,IAAIR,aAAJ,CAAkB4B,UAAlB,CAAd;AAAA,yBADH,EAEFpB,IAFE,CAEG;AAAA,mCAAOqB,IAAIC,QAAJ,CAAaJ,UAAb,CAAP;AAAA,yBAFH,EAGFlB,IAHE,CAGG;AAAA,mCAAYuB,QAAZ;AAAA,yBAHH,EAIFjB,KAJE,CAII,gBAAQ;AAAC,kCAAM,IAAII,KAAJ,CAAUD,IAAV,CAAN;AAAsB,yBAJnC,CAAP;AAKH;;;4CAEO;AACJ,+BAAOnB,kBAAkB6B,aAAlB,GACFnB,IADE,CACG;AAAA,mCAAc,IAAIR,aAAJ,CAAkB4B,UAAlB,CAAd;AAAA,yBADH,EAEFpB,IAFE,CAEG;AAAA,mCAAOqB,IAAIG,UAAJ,EAAP;AAAA,yBAFH,EAGFxB,IAHE,CAGG;AAAA,mCAAYuB,QAAZ;AAAA,yBAHH,EAIFjB,KAJE,CAII,gBAAQ;AAAC,kCAAM,IAAII,KAAJ,CAAUD,IAAV,CAAN;AAAsB,yBAJnC,CAAP;AAKH;;;4CAEO;AACJ,+BAAOnB,kBAAkB6B,aAAlB,GACFnB,IADE,CACG;AAAA,mCAAc,IAAIR,aAAJ,CAAkB4B,UAAlB,CAAd;AAAA,yBADH,EAEFpB,IAFE,CAEG;AAAA,mCAAOqB,IAAII,UAAJ,EAAP;AAAA,yBAFH,EAGFnB,KAHE,CAGI,gBAAQ;AAAC,kCAAM,IAAII,KAAJ,CAAUD,IAAV,CAAN;AAAsB,yBAHnC,CAAP;AAIH;;;4CAEOiB,U,EAAY;AAChB,+BAAO,KAAKC,gBAAL,GACF3B,IADE,CACG;AAAA,mCACFI,YAAYwB,MAAZ,CAAmB;AAAA,uCACf,CAACF,WAAWG,IAAX,CAAgB;AAAA,2CACbC,oBAAoBC,QAApB,CAA6Bb,UAA7B,CADa;AAAA,iCAAhB,CADc;AAAA,6BAAnB,CADE;AAAA,yBADH,EAKFZ,KALE,CAKI,gBAAQ;AAAC,kCAAM,IAAII,KAAJ,CAAUD,IAAV,CAAN;AAAsB,yBALnC,CAAP;AAMH","file":"NegociacaoService.js","sourcesContent":["import {HttpService} from './HttpService';\r\nimport {ConnectionFactory} from './ConnectionFactory';\r\nimport {Negociacao} from '../models/Negociacao';\r\nimport {NegociacaoDao} from '../dao/NegociacaoDao';\r\n\r\nexport class NegociacaoService {\r\n    constructor() {\r\n        this._service = new HttpService();\r\n    }\r\n\r\n    obterNegociacoes() {\r\n        return Promise.all([\r\n            this.obterNegociacoesDaSemana(),\r\n            this.obterNegociacoesDaSemanaAnterior(),\r\n            this.obterNegociacoesDaSemanaRetrasada()        \r\n        ])\r\n        .then(listaTodasAsNegociacoes => {\r\n            return listaTodasAsNegociacoes\r\n                .reduce((todasAsNegociacoes, negociacoes) => todasAsNegociacoes.concat(negociacoes), []);\r\n        })            \r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error(erro)\r\n        });\r\n    }\r\n    \r\n    obterNegociacoesDaSemana() {\r\n        return this._service.get('negociacoes/semana')\r\n            .then(negociacoes => {\r\n                return negociacoes.map(objeto => new Negociacao(new Date(objeto.data),\r\n                    objeto.quantidade, objeto.valor));\r\n            })\r\n            .catch(erro => {\r\n                console.log(`Não foi possível importar negociações da semana (${erro})`);\r\n                throw new Error(erro);\r\n                // throw new Error('Não foi possível importar negociações da semana.');\r\n            });\r\n    }\r\n\r\n    obterNegociacoesDaSemanaAnterior() {\r\n        return this._service.get('negociacoes/anterior')\r\n            .then(negociacoes => {\r\n                return negociacoes.map(objeto => new Negociacao(new Date(objeto.data),\r\n                    objeto.quantidade, objeto.valor));\r\n            })\r\n            .catch(erro => {\r\n                console.log(`Não foi possível importar negociações da semana anterior (${erro})`);\r\n                throw new Error(erro);\r\n                // throw new Error('Não foi possível importar negociações da semana anterior.');\r\n            });\r\n    }\r\n\r\n    obterNegociacoesDaSemanaRetrasada() {\r\n        return this._service.get('negociacoes/retrasada')\r\n            .then(negociacoes => {\r\n                return negociacoes.map(objeto => new Negociacao(new Date(objeto.data),\r\n                    objeto.quantidade, objeto.valor));\r\n            })\r\n            .catch(erro => {\r\n                console.log(`Não foi possível importar negociações da semana retrasada (${erro})`);\r\n                throw new Error(erro);\r\n                // throw new Error('Não foi possível importar negociações da semana retrasada.');\r\n            });\r\n    }\r\n\r\n    cadastra(negociacao) {\r\n        return ConnectionFactory.getConnection()\r\n            .then(connection => new NegociacaoDao(connection))\r\n            .then(dao => dao.adiciona(negociacao))\r\n            .then(mensagem => mensagem)\r\n            .catch(erro => {throw new Error(erro)});\r\n    }\r\n\r\n    apaga() {\r\n        return ConnectionFactory.getConnection()\r\n            .then(connection => new NegociacaoDao(connection))\r\n            .then(dao => dao.apagaTodos())\r\n            .then(mensagem => mensagem)\r\n            .catch(erro => {throw new Error(erro)});\r\n    }\r\n\r\n    lista() {\r\n        return ConnectionFactory.getConnection()\r\n            .then(connection => new NegociacaoDao(connection))\r\n            .then(dao => dao.listaTodos())\r\n            .catch(erro => {throw new Error(erro)});\r\n    }\r\n\r\n    importa(listaAtual) {\r\n        return this.obterNegociacoes()\r\n            .then(negociacoes => \r\n                negociacoes.filter(negociacao => \r\n                    !listaAtual.some(negociacaoExistente => \r\n                        negociacaoExistente.isEquals(negociacao))))\r\n            .catch(erro => {throw new Error(erro)});\r\n    }\r\n}"]}